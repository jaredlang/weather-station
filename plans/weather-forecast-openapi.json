{
    "openapi": "3.1.0",
    "info": {
        "title": "Weather Forecast API",
        "description": "REST API for weather forecast retrieval",
        "version": "1.0.0"
    },
    "paths": {
        "/weather/{city}": {
            "get": {
                "tags": [
                    "Weather"
                ],
                "summary": "Get latest forecast for a city",
                "description": "Retrieves the most recent valid (non-expired) forecast for the specified city",
                "operationId": "get_latest_forecast_weather__city__get",
                "parameters": [
                    {
                        "name": "city",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "description": "City name (case-insensitive)",
                            "title": "City"
                        },
                        "description": "City name (case-insensitive)"
                    },
                    {
                        "name": "language",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "anyOf": [
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "null"
                                }
                            ],
                            "description": "ISO 639-1 language code filter",
                            "title": "Language"
                        },
                        "description": "ISO 639-1 language code filter"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Successful response with forecast data",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/WeatherResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Forecast not found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/WeatherNotFoundResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Database connection error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "422": {
                        "description": "Validation Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/HTTPValidationError"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/weather/{city}/history": {
            "get": {
                "tags": [
                    "Weather"
                ],
                "summary": "Get forecast history for a city",
                "description": "Retrieves historical forecasts for a city with optional filtering",
                "operationId": "get_forecast_history_weather__city__history_get",
                "parameters": [
                    {
                        "name": "city",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "description": "City name",
                            "title": "City"
                        },
                        "description": "City name"
                    },
                    {
                        "name": "limit",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "integer",
                            "maximum": 100,
                            "minimum": 1,
                            "description": "Maximum number of results",
                            "default": 10,
                            "title": "Limit"
                        },
                        "description": "Maximum number of results"
                    },
                    {
                        "name": "include_expired",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "boolean",
                            "description": "Include expired forecasts",
                            "default": false,
                            "title": "Include Expired"
                        },
                        "description": "Include expired forecasts"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Successful response with forecast history",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/HistoryResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Database connection error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    },
                    "422": {
                        "description": "Validation Error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/HTTPValidationError"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/stats/": {
            "get": {
                "tags": [
                    "Statistics"
                ],
                "summary": "Get storage statistics",
                "description": "Retrieves database storage statistics including forecast counts and sizes",
                "operationId": "get_stats_stats__get",
                "responses": {
                    "200": {
                        "description": "Successful response with storage statistics",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/StatsResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Database connection error",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ErrorResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/health/": {
            "get": {
                "tags": [
                    "Health"
                ],
                "summary": "Health check",
                "description": "Verifies API and database connectivity status",
                "operationId": "health_check_health__get",
                "responses": {
                    "200": {
                        "description": "Service is healthy",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/HealthResponse"
                                }
                            }
                        }
                    },
                    "503": {
                        "description": "Service is unhealthy"
                    }
                }
            }
        },
        "/": {
            "get": {
                "tags": [
                    "Root"
                ],
                "summary": "Root",
                "operationId": "root__get",
                "responses": {
                    "200": {
                        "description": "Successful Response",
                        "content": {
                            "application/json": {
                                "schema": {}
                            }
                        }
                    }
                }
            }
        }
    },
    "components": {
        "schemas": {
            "CityStatistics": {
                "properties": {
                    "city": {
                        "type": "string",
                        "title": "City"
                    },
                    "forecast_count": {
                        "type": "integer",
                        "title": "Forecast Count"
                    },
                    "total_text_bytes": {
                        "type": "integer",
                        "title": "Total Text Bytes"
                    },
                    "total_audio_bytes": {
                        "type": "integer",
                        "title": "Total Audio Bytes"
                    },
                    "latest_forecast": {
                        "anyOf": [
                            {
                                "type": "string"
                            },
                            {
                                "type": "null"
                            }
                        ],
                        "title": "Latest Forecast"
                    }
                },
                "type": "object",
                "required": [
                    "city",
                    "forecast_count",
                    "total_text_bytes",
                    "total_audio_bytes"
                ],
                "title": "CityStatistics"
            },
            "DatabaseHealth": {
                "properties": {
                    "connected": {
                        "type": "boolean",
                        "title": "Connected"
                    },
                    "instance": {
                        "anyOf": [
                            {
                                "type": "string"
                            },
                            {
                                "type": "null"
                            }
                        ],
                        "title": "Instance"
                    },
                    "database": {
                        "anyOf": [
                            {
                                "type": "string"
                            },
                            {
                                "type": "null"
                            }
                        ],
                        "title": "Database"
                    },
                    "version": {
                        "anyOf": [
                            {
                                "type": "string"
                            },
                            {
                                "type": "null"
                            }
                        ],
                        "title": "Version"
                    },
                    "forecasts_table_exists": {
                        "anyOf": [
                            {
                                "type": "boolean"
                            },
                            {
                                "type": "null"
                            }
                        ],
                        "title": "Forecasts Table Exists"
                    },
                    "error": {
                        "anyOf": [
                            {
                                "type": "string"
                            },
                            {
                                "type": "null"
                            }
                        ],
                        "title": "Error"
                    }
                },
                "type": "object",
                "required": [
                    "connected"
                ],
                "title": "DatabaseHealth"
            },
            "ErrorResponse": {
                "properties": {
                    "status": {
                        "type": "string",
                        "title": "Status",
                        "default": "error"
                    },
                    "message": {
                        "type": "string",
                        "title": "Message"
                    },
                    "detail": {
                        "anyOf": [
                            {
                                "additionalProperties": true,
                                "type": "object"
                            },
                            {
                                "type": "null"
                            }
                        ],
                        "title": "Detail"
                    }
                },
                "type": "object",
                "required": [
                    "message"
                ],
                "title": "ErrorResponse"
            },
            "ForecastData": {
                "properties": {
                    "text": {
                        "type": "string",
                        "title": "Text",
                        "description": "Forecast text content"
                    },
                    "audio_base64": {
                        "type": "string",
                        "title": "Audio Base64",
                        "description": "Base64-encoded audio WAV data"
                    },
                    "forecast_at": {
                        "type": "string",
                        "title": "Forecast At",
                        "description": "When forecast was made (ISO 8601)"
                    },
                    "expires_at": {
                        "type": "string",
                        "title": "Expires At",
                        "description": "When forecast expires (ISO 8601)"
                    },
                    "age_seconds": {
                        "type": "integer",
                        "title": "Age Seconds",
                        "description": "Age of forecast in seconds"
                    },
                    "metadata": {
                        "$ref": "#/components/schemas/ForecastMetadata"
                    }
                },
                "type": "object",
                "required": [
                    "text",
                    "audio_base64",
                    "forecast_at",
                    "expires_at",
                    "age_seconds",
                    "metadata"
                ],
                "title": "ForecastData"
            },
            "ForecastMetadata": {
                "properties": {
                    "encoding": {
                        "type": "string",
                        "title": "Encoding"
                    },
                    "language": {
                        "anyOf": [
                            {
                                "type": "string"
                            },
                            {
                                "type": "null"
                            }
                        ],
                        "title": "Language"
                    },
                    "locale": {
                        "anyOf": [
                            {
                                "type": "string"
                            },
                            {
                                "type": "null"
                            }
                        ],
                        "title": "Locale"
                    },
                    "sizes": {
                        "additionalProperties": {
                            "type": "integer"
                        },
                        "type": "object",
                        "title": "Sizes"
                    }
                },
                "type": "object",
                "required": [
                    "encoding",
                    "sizes"
                ],
                "title": "ForecastMetadata"
            },
            "HTTPValidationError": {
                "properties": {
                    "detail": {
                        "items": {
                            "$ref": "#/components/schemas/ValidationError"
                        },
                        "type": "array",
                        "title": "Detail"
                    }
                },
                "type": "object",
                "title": "HTTPValidationError"
            },
            "HealthResponse": {
                "properties": {
                    "status": {
                        "type": "string",
                        "title": "Status"
                    },
                    "timestamp": {
                        "type": "string",
                        "title": "Timestamp"
                    },
                    "database": {
                        "$ref": "#/components/schemas/DatabaseHealth"
                    },
                    "api_version": {
                        "type": "string",
                        "title": "Api Version"
                    }
                },
                "type": "object",
                "required": [
                    "status",
                    "timestamp",
                    "database",
                    "api_version"
                ],
                "title": "HealthResponse"
            },
            "HistoricalForecast": {
                "properties": {
                    "forecast_id": {
                        "type": "string",
                        "title": "Forecast Id"
                    },
                    "forecast_at": {
                        "type": "string",
                        "title": "Forecast At"
                    },
                    "expires_at": {
                        "type": "string",
                        "title": "Expires At"
                    },
                    "expired": {
                        "type": "boolean",
                        "title": "Expired"
                    },
                    "encoding": {
                        "type": "string",
                        "title": "Encoding"
                    },
                    "language": {
                        "anyOf": [
                            {
                                "type": "string"
                            },
                            {
                                "type": "null"
                            }
                        ],
                        "title": "Language"
                    },
                    "locale": {
                        "anyOf": [
                            {
                                "type": "string"
                            },
                            {
                                "type": "null"
                            }
                        ],
                        "title": "Locale"
                    },
                    "sizes": {
                        "additionalProperties": {
                            "type": "integer"
                        },
                        "type": "object",
                        "title": "Sizes"
                    },
                    "created_at": {
                        "type": "string",
                        "title": "Created At"
                    }
                },
                "type": "object",
                "required": [
                    "forecast_id",
                    "forecast_at",
                    "expires_at",
                    "expired",
                    "encoding",
                    "sizes",
                    "created_at"
                ],
                "title": "HistoricalForecast"
            },
            "HistoryResponse": {
                "properties": {
                    "status": {
                        "type": "string",
                        "title": "Status",
                        "default": "success"
                    },
                    "city": {
                        "type": "string",
                        "title": "City"
                    },
                    "count": {
                        "type": "integer",
                        "title": "Count"
                    },
                    "forecasts": {
                        "items": {
                            "$ref": "#/components/schemas/HistoricalForecast"
                        },
                        "type": "array",
                        "title": "Forecasts"
                    }
                },
                "type": "object",
                "required": [
                    "city",
                    "count",
                    "forecasts"
                ],
                "title": "HistoryResponse"
            },
            "StatsResponse": {
                "properties": {
                    "status": {
                        "type": "string",
                        "title": "Status",
                        "default": "success"
                    },
                    "statistics": {
                        "$ref": "#/components/schemas/StorageStatistics"
                    }
                },
                "type": "object",
                "required": [
                    "statistics"
                ],
                "title": "StatsResponse"
            },
            "StorageStatistics": {
                "properties": {
                    "total_forecasts": {
                        "type": "integer",
                        "title": "Total Forecasts"
                    },
                    "total_text_bytes": {
                        "type": "integer",
                        "title": "Total Text Bytes"
                    },
                    "total_audio_bytes": {
                        "type": "integer",
                        "title": "Total Audio Bytes"
                    },
                    "encodings_used": {
                        "additionalProperties": {
                            "type": "integer"
                        },
                        "type": "object",
                        "title": "Encodings Used"
                    },
                    "languages_used": {
                        "additionalProperties": {
                            "type": "integer"
                        },
                        "type": "object",
                        "title": "Languages Used"
                    },
                    "city_breakdown": {
                        "items": {
                            "$ref": "#/components/schemas/CityStatistics"
                        },
                        "type": "array",
                        "title": "City Breakdown"
                    }
                },
                "type": "object",
                "required": [
                    "total_forecasts",
                    "total_text_bytes",
                    "total_audio_bytes",
                    "encodings_used",
                    "languages_used",
                    "city_breakdown"
                ],
                "title": "StorageStatistics"
            },
            "ValidationError": {
                "properties": {
                    "loc": {
                        "items": {
                            "anyOf": [
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "integer"
                                }
                            ]
                        },
                        "type": "array",
                        "title": "Location"
                    },
                    "msg": {
                        "type": "string",
                        "title": "Message"
                    },
                    "type": {
                        "type": "string",
                        "title": "Error Type"
                    }
                },
                "type": "object",
                "required": [
                    "loc",
                    "msg",
                    "type"
                ],
                "title": "ValidationError"
            },
            "WeatherNotFoundResponse": {
                "properties": {
                    "status": {
                        "type": "string",
                        "title": "Status",
                        "default": "error"
                    },
                    "message": {
                        "type": "string",
                        "title": "Message"
                    }
                },
                "type": "object",
                "required": [
                    "message"
                ],
                "title": "WeatherNotFoundResponse"
            },
            "WeatherResponse": {
                "properties": {
                    "status": {
                        "type": "string",
                        "title": "Status",
                        "default": "success"
                    },
                    "city": {
                        "type": "string",
                        "title": "City"
                    },
                    "forecast": {
                        "$ref": "#/components/schemas/ForecastData"
                    }
                },
                "type": "object",
                "required": [
                    "city",
                    "forecast"
                ],
                "title": "WeatherResponse"
            }
        }
    }
}